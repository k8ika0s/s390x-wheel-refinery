FROM registry.access.redhat.com/ubi9/ubi:9.3 AS builder
RUN dnf -y update && \
    dnf -y install golang git make gcc && \
    dnf clean all

WORKDIR /src
ARG MINIO_TAG=RELEASE.2024-12-07T00-52-20Z
RUN git clone https://github.com/minio/minio.git . && git checkout "$MINIO_TAG"
RUN CGO_ENABLED=0 GOOS=linux GOARCH=s390x go build -trimpath -o /minio ./cmd/minio

FROM registry.access.redhat.com/ubi9/ubi-minimal:9.3
RUN microdnf -y update && microdnf -y install shadow-utils && microdnf clean all
RUN useradd -r -u 1000 minio && mkdir -p /data && chown -R minio:minio /data
COPY --from=builder /minio /usr/local/bin/minio
USER minio
EXPOSE 9000 9001
ENTRYPOINT ["/usr/local/bin/minio"]
CMD ["server", "/data", "--console-address", ":9001"]
