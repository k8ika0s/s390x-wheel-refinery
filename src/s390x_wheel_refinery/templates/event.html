<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>{{ event.name }} {{ event.version }} event</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 24px; background: #0f172a; color: #e2e8f0; }
      a { color: #38bdf8; text-decoration: none; }
      a:hover { text-decoration: underline; }
      .card { background: #1e293b; padding: 12px 16px; border-radius: 8px; margin-bottom: 12px; }
      pre { background: #0b1220; padding: 12px; border-radius: 8px; overflow-x: auto; }
      .meta { font-size: 12px; color: #cbd5e1; }
    </style>
  </head>
  <body>
    <a href="/">‚Üê Back</a>
    <h1>{{ event.name }} {{ event.version }}</h1>
    <div class="card">
      <div>Status: {{ event.status }}</div>
      <div class="meta">{{ event.python_tag }}/{{ event.platform_tag }} | {{ event.timestamp }}</div>
      {% if event.detail %}<div class="meta">detail: {{ event.detail }}</div>{% endif %}
      {% if event.wheel_path %}<div class="meta">wheel: {{ event.wheel_path }}</div>{% endif %}
      {% if event.metadata.log_path %}<div class="meta">log: <a href="/logs/{{ event.name }}/{{ event.version }}">{{ event.metadata.log_path }}</a></div>{% endif %}
      {% if event.metadata.hint %}<div class="meta">hint: {{ event.metadata.hint }}</div>{% endif %}
      {% if event.metadata.duration_seconds %}<div class="meta">attempt duration: {{ event.metadata.duration_seconds }}s</div>{% endif %}
    </div>
    {% if event.metadata %}
    <div class="card">
      <h3>Metadata</h3>
      <pre>{{ event.metadata | tojson(indent=2) }}</pre>
    </div>
    {% endif %}
    {% if event.metadata.log_path %}
    <div class="card">
      <h3>Live log</h3>
      <pre id="log-stream" style="max-height: 400px;"></pre>
    </div>
    <script>
      const logEl = document.getElementById('log-stream');
      if (logEl) {
        const evtSource = new EventSource(`/logs/{{ event.name }}/{{ event.version }}/stream`);
        evtSource.onmessage = (e) => {
          logEl.textContent += e.data + "\\n";
          logEl.scrollTop = logEl.scrollHeight;
        };
        evtSource.onerror = () => {
          evtSource.close();
        };
      }
    </script>
    {% endif %}
  </body>
</html>
